\newpage
\section{\textbf{PHÂN TÍCH VÀ THIẾT KẾ HỆ THỐNG}}

\subsection{Phân tích Use Case}

\textbf{Các tác nhân chính:}
\begin{itemize}
    \item \textbf{Khách hàng}: Đăng ký/nhập, xem sản phẩm, tìm kiếm, giỏ hàng, thanh toán, đánh giá
    \item \textbf{Quản trị viên}: Quản lý sản phẩm, đơn hàng, người dùng, coupon, kiểm duyệt đánh giá
    \item \textbf{Hệ thống MoMo}: Xử lý thanh toán, gửi kết quả IPN
    \item \textbf{Hệ thống AI}: Phân tích ABSA, Content Moderation
\end{itemize}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.9\textwidth]{image/sequence/2.png}
    \caption{Sơ đồ Use Case Tổng quát hệ thống VeritaShop}
    \label{fig:usecase}
\end{figure}

\subsection{Đặc tả Use Case chính}

\begin{table}[H]
\centering
\caption{Đặc tả các Use Case chính}
\renewcommand{\arraystretch}{1.25}
\begin{tabular}{|p{2.8cm}|p{2.5cm}|p{8cm}|}
\hline
\textbf{Use Case} & \textbf{Tác nhân} & \textbf{Mô tả chi tiết} \\
\hline
Tìm kiếm sản phẩm & Khách hàng & Lọc theo brand (iPhone, Samsung...), khoảng giá, tình trạng (mới, like new, used). Sắp xếp theo giá/rating/mới nhất. Server-side search với phân trang. \\
\hline
Thanh toán đơn hàng & Khách hàng, MoMo & Checkout 5 bước: Review giỏ → Chọn địa chỉ → Áp dụng coupon → Chọn phương thức (COD/MoMo) → Xác nhận. MoMo: Deep Link mở app → Xác nhận → IPN callback. \\
\hline
Đánh giá sản phẩm & Khách hàng, AI & Viết review (1-5 sao, tiêu đề, nội dung, upload ảnh) → Content Moderation kiểm tra → ABSA phân tích cảm xúc theo aspects → Lưu kết quả. \\
\hline
Quản lý đơn hàng & Admin & Xem danh sách với bộ lọc. Cập nhật trạng thái: pending → confirmed → processing → shipping → delivered (hoặc cancelled). \\
\hline
Kiểm duyệt đánh giá & Admin & Xem review bị flag. Xem kết quả ABSA và Content Moderation. Approve (hiển thị) / Reject (ẩn) / Delete. \\
\hline
\end{tabular}
\end{table}

\newpage
\subsection{Thiết kế Activity Diagram}

\textbf{Quy trình Checkout và Thanh toán:}

\begin{figure}[H]
    \centering
    \begin{subfigure}[b]{0.48\textwidth}
        \centering
        \includegraphics[width=0.65\textwidth]{image/sequence/3a.png}
        \caption{Giai đoạn chọn sản phẩm và địa chỉ}
    \end{subfigure}
    \hfill
    \begin{subfigure}[b]{0.48\textwidth}
        \centering
        \includegraphics[width=0.65\textwidth]{image/sequence/3b.png}
        \caption{Giai đoạn thanh toán và hoàn tất}
    \end{subfigure}
    \caption{Sơ đồ hoạt động chức năng Checkout}
    \label{fig:activity_checkout}
\end{figure}

\textbf{Quy trình Thanh toán MoMo:}

\begin{figure}[H]
    \centering
    \begin{subfigure}[b]{0.48\textwidth}
        \centering
        \includegraphics[width=0.65\textwidth]{image/sequence/4a.png}
        \caption{Tạo yêu cầu thanh toán}
    \end{subfigure}
    \hfill
    \begin{subfigure}[b]{0.48\textwidth}
        \centering
        \includegraphics[width=0.65\textwidth]{image/sequence/4b.png}
        \caption{Xử lý IPN callback}
    \end{subfigure}
    \caption{Sơ đồ hoạt động thanh toán MoMo}
    \label{fig:activity_momo}
\end{figure}

\subsection{Luồng màn hình Customer App}

\begin{enumerate}
    \item \textbf{Khởi động}: Splash → Login/Register → Home
    \item \textbf{Mua sắm}: Home → Product List → Product Detail → Add to Cart / Buy Now
    \item \textbf{Thanh toán}: Cart → Checkout → Address → Payment → Order Success
    \item \textbf{Đơn hàng}: Profile → Order History → Order Detail
    \item \textbf{Đánh giá}: Product Detail → Reviews → Write Review → ABSA Result
\end{enumerate}

