\newpage
\section{\textbf{PHÂN TÍCH VÀ THIẾT KẾ HỆ THỐNG}}

\subsection{Phân tích Use Case}

\textbf{Các tác nhân chính:}
\begin{itemize}
    \item \textbf{Khách hàng}: Đăng ký/nhập, xem sản phẩm, tìm kiếm, giỏ hàng, thanh toán, đánh giá
    \item \textbf{Quản trị viên}: Quản lý sản phẩm, đơn hàng, người dùng, coupon, kiểm duyệt đánh giá
    \item \textbf{Hệ thống MoMo}: Xử lý thanh toán, gửi kết quả IPN
    \item \textbf{Hệ thống AI}: Phân tích ABSA, Content Moderation
\end{itemize}

\begin{figure}[H]
    \centering
    \includegraphics[width=0.5\textwidth]{image/sequence/3.png}
    \caption{Sơ đồ Use Case Tổng quát hệ thống VeritaShop}
    \label{fig:usecase}
\end{figure}

\subsection{Đặc tả Use Case chính}

\begin{table}[H]
\centering
\caption{Đặc tả các Use Case chính}
\renewcommand{\arraystretch}{1.25}
\begin{tabular}{|p{2.8cm}|p{2.5cm}|p{8cm}|}
\hline
\textbf{Use Case} & \textbf{Tác nhân} & \textbf{Mô tả} \\
\hline
Tìm kiếm sản phẩm & Khách hàng & Lọc theo brand, giá, tình trạng. Sắp xếp theo giá/rating/mới nhất. \\
\hline
Thanh toán đơn hàng & Khách hàng, MoMo & Checkout 5 bước → COD hoặc MoMo (Deep Link + IPN). \\
\hline
Đánh giá sản phẩm & Khách hàng, AI & Viết review → Content Moderation → ABSA phân tích → Lưu kết quả. \\
\hline
Quản lý đơn hàng & Admin & Xem danh sách, cập nhật trạng thái (pending→delivered/cancelled). \\
\hline
Kiểm duyệt đánh giá & Admin & Xem review bị flag, kết quả ABSA. Approve/Reject/Delete. \\
\hline
\end{tabular}
\end{table}

\subsection{Luồng màn hình Customer App}

\begin{enumerate}
    \item \textbf{Khởi động}: Splash → Login/Register → Home
    \item \textbf{Mua sắm}: Home → Product List → Product Detail → Add to Cart / Buy Now
    \item \textbf{Thanh toán}: Cart → Checkout → Address → Payment → Order Success
    \item \textbf{Đơn hàng}: Profile → Order History → Order Detail
    \item \textbf{Đánh giá}: Product Detail → Reviews → Write Review → ABSA Result
\end{enumerate}

\subsection{Quy trình đánh giá với ABSA}

Khi người dùng viết đánh giá sản phẩm, hệ thống tự động phân tích cảm xúc theo quy trình:

\begin{enumerate}
    \item \textbf{Input}: Người dùng nhập rating (1-5 sao), tiêu đề, nội dung, upload ảnh (tối đa 5)
    \item \textbf{Content Moderation}: API kiểm tra nội dung vi phạm (harassment, hate, violence...)
    \item \textbf{Xử lý flag}: Nếu bị flag → isFlagged=true, moderationStatus='pending', chờ Admin duyệt
    \item \textbf{ABSA Processing}: Nếu pass → Gửi text đến ABSA Service
    \item \textbf{Aspect Detection}: Xác định review đề cập những khía cạnh nào (Battery, Camera, Shipping...)
    \item \textbf{Sentiment Classification}: Với mỗi aspect, phân loại cảm xúc (Positive/Negative/Neutral)
    \item \textbf{Lưu kết quả}: Lưu sentimentAnalysis[], overallSentiment vào Review document
    \item \textbf{Cập nhật rating}: Tính lại điểm trung bình cho Product
\end{enumerate}

\textbf{Hiển thị kết quả ABSA cho người dùng:}
\begin{itemize}
    \item Biểu đồ thanh ngang cho từng aspect với màu sắc (xanh/đỏ/xám)
    \item Confidence score (độ tin cậy) của mỗi phân tích
    \item Overall sentiment badge (Positive/Negative/Neutral/Mixed)
\end{itemize}

